<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/older_booking.css" />
    <title>Older Bookings - Radisson Blu Hotel</title>
  </head>
  <body>
    <div class="wrapper">
      <aside class="sidebar">
        <div class="profile">
          <div class="profile-image">
            <img id="img-id" src="./assets/img1.jpg" alt="Profile Image" />
          </div>
          <div class="profile-info">
            <h2>Radisson Blu</h2>
            <p>Dashboard</p>
          </div>
        </div>
        <nav class="nav-menu">
          <div class="nav-item">
            <a href="dashboard.html">
              <i class="icon">🏠</i>
              <span>Dashboard</span>
            </a>
          </div>
          <div class="nav-item">
            <a href="rooms.html">
              <i class="icon">🛏️</i>
              <span>Rooms</span>
            </a>
          </div>
          <div class="nav-item">
            <a href="bookings.html">
              <i class="icon">📝</i>
              <span>Bookings</span>
            </a>
          </div>
          <div class="nav-item">
            <a href="checkout.html">
              <i class="icon">✅</i>
              <span>Payments</span>
            </a>
          </div>
          <div class="nav-item active">
            <a href="older_bookings.html">
              <i class="icon">📚</i>
              <span>Older Bookings</span>
            </a>
          </div>
          <div class="nav-item">
            <a href="registration.html">
              <i class="icon">👥</i>
              <span>Registration</span>
            </a>
          </div>
          <div class="nav-item logout">
            <a href="logout.html">
              <i class="icon">🚪</i>
              <span>Log Out</span>
            </a>
          </div>
        </nav>
      </aside>

      <main class="older-bookings">
        <h2>Your Older Bookings</h2>
        <ul id="olderBookingList"></ul>
      </main>
    </div>

    <script>
      fetch("php/get_completed_bookings.php")
        .then((response) => response.json())
        .then((data) => {
          const olderBookingList = document.getElementById("olderBookingList");
          data.forEach((booking) => {
            const li = document.createElement("li");
            li.innerHTML = `
                <div class="booking-details">
                    <p><strong>Name:</strong> ${booking.name}</p>
                    <p><strong>Email:</strong> ${booking.email}</p>
                    <p><strong>Room Type:</strong> ${booking.room_type}</p>
                    <p><strong>Check-In:</strong> ${booking.checkin_date}</p>
                    <p><strong>Check-Out:</strong> ${booking.checkout_date}</p>
                </div>
                <div class="booking-action">
                    <button class="view-details-btn delete-btn" data-id="${booking.id}">Delete</button>
                </div>
            `;
            olderBookingList.appendChild(li);
          });

          // Add event listener for delete buttons
          document.querySelectorAll(".delete-btn").forEach((button) => {
            button.addEventListener("click", function () {
              const bookingId = this.dataset.id;

              // Confirm deletion
              if (confirm("Are you sure you want to delete this booking?")) {
                fetch("php/delete_booking.php", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                  },
                  body: `id=${bookingId}&_method=DELETE`,
                })
                  .then((response) => {
                    if (response.ok) {
                      // Remove the booking element from the list
                      this.closest("li").remove();
                      alert("Booking deleted successfully!");
                    } else {
                      alert("Failed to delete booking. Please try again.");
                    }
                  })
                  .catch((error) =>
                    console.error("Error deleting booking:", error)
                  );
              }
            });
          });
        })
        .catch((error) =>
          console.error("Error fetching completed bookings:", error)
        );
    </script>
  </body>
</html>
